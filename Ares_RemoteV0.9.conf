name: Ares_RemoteV0.9
slots:
  databank:
    class: DataBank
  warpdrive:
    class: WarpDriveUnit
  core:
    class: CoreUnit
  engine:
    class: Engineunit
    select: manual
handlers:
  unit:
    onStart:
      lua: |
        packagePrefix = "autoconf.custom.AresOS."
        package.preload[packagePrefix.."menuscreener"] = function()
           local self={}self.viewTags={"screen"}self.loadPrio=100;self.version=0.9;local a=0;local b=nil;local c=nil;local d=false;local e="AQN5B4-@7gSt1W?;"function self:valid(f)return true end;local g="Main"local h={}local i={}function self:addMenu(j,k)h[j]=k end;local l="gunner"function self:onMouseDown(m,n,o)end;function self:onMouseUp(m,n,o)m=m*100;n=n*100;for p,q in pairs(i)do if q.top<=n and n<=q.top+q.height and q.left<=m and m<=q.left+q.width then pcall(q.func)break end end end;function self:addButton(r,s,t,u,k)table.insert(i,{["top"]=s,["left"]=r,["width"]=t,["height"]=u,["func"]=k})end;function self:addFancyButton(r,s,t,u,k,j,v,w,x)table.insert(i,{["top"]=s,["left"]=r,["width"]=t,["height"]=u,["func"]=k})local y=0.2;if s<=w and w<=s+u and r<=v and v<=r+t then y=0.5 end;x=x or"4682B4"local z=[[                        
                <rect x="]]..r..[[%" y="]]..s..[[%" rx="2" ry="2" width="]]..t..[[%" height="]]..u..[[%" style="fill:#]]..x..[[;fill-opacity:]]..y..[[" />
                <text x="]]..r+t*0.1 ..[[%" y="]]..s+u*0.7 ..[[%" style="fill:#FFFFFF;font-size:]]..u*1.5 ..[[">]]..j..[[</text>
            ]]return z end;function self:register(A)_ENV=A;if not self:valid(e)then return end;b=getPlugin("BaseFlight",true)c=getPlugin("screener",true)if c==nil then return end;c:addScreen("centerfirst",{offsetx=0.3035,offsety=0.11,width=0.393,height=0.7,perspective="first",parent="mainScreenFirst"})c:registerDefaultScreen("centerfirst","Menu")c:addView("Menu",self)register:addAction("option6Start","Exit",function()system.lockView(0)d=false;c:freeMouse(false)if b~=nil then b:setUpdateState(true)end end)register:addAction("systemOnCameraChanged","ViewLocker",function(B)if B==1 then system.lockView(1)d=true;c:freeMouse(true)else system.lockView(0)d=false;c:freeMouse(false)if b~=nil then b:setUpdateState(true)end end end)self:addMenu("Settings",function(v,w,C,D)self:addButton(3,10,20,3,function()l="gunner"a=0 end)self:addButton(53,10,20,3,function()l="remote"a=0 end)if D then if b~=nil then b:setUpdateState(false)end;a=a+system.getMouseWheel()*-1 else if b~=nil then b:setUpdateState(true)end end;if a<0 then a=0 end;local z=""if unitType=="gunner"then local E="4682B4"local F="4682B4"if l=="gunner"then E="00ff00"else F="00ff00"end;z=[[           
                    <rect x="2%" y="9%" rx="2" ry="2" width="96%" height="89%" style="fill:#4682B4;fill-opacity:0.35" />
        
                    <rect x="3%" y="10%" rx="2" ry="2" width="20%" height="3%" style="fill:#]]..E..[[;fill-opacity:0.8" />
                    <text x="5%" y="12%" style="fill:#FFFFFF;font-size:6">Gunner</text>
        
                    <rect x="53%" y="10%" rx="2" ry="2" width="20%" height="3%" style="fill:#]]..F..[[;fill-opacity:0.8" />
                    <text x="55%" y="12%" style="fill:#FFFFFF;font-size:6">Remote</text>
                    ]]end;if unitType==l then z=z..[[]]local G={}local H=getPlugin("Settings")for I,J in pairs(H.Description)do table.insert(G,{I,nil})for j,K in pairs(J)do table.insert(G,{I,j})end end;local y=false;for L=1,80,1 do local x=L+a;local M=0;y=not y;if y then M=0.3 end;if G[x]==nil then break end;local N=G[x][1]local O=G[x][2]local P="4682B4"if L*3+13.2<=w and w<=L*3+13+2.5 and 2.5<=v and v<=2.5+95 then P="244c9c"M=0.3 end;if O==nil then z=z..[[<rect x="2.5%" y="]]..L*3+13 ..[[%" rx="2" ry="2" width="95%" height="3%" style="fill:#]]..P..[[;fill-opacity:]]..M..[[" /><text x="5%" y="]]..L*3+15 ..[[%" style="fill:#FFFFFF;font-size:5">]]..N..[[</text>]]else z=z..[[<rect x="2.5%" y="]]..L*3+13 ..[[%" rx="2" ry="2" width="95%" height="3%" style="fill:#]]..P..[[;fill-opacity:]]..M..[[" /><text x="5%" y="]]..L*3+15 ..[[%" style="fill:#FFFFFF;font-size:5">]]..O..[[</text><text x="60%" y="]]..L*3+15 ..[[%" style="fill:#FFFFFF;font-size:5">]]..H.Description[N][O]..[[</text>
                            <text x="25%" y="]]..L*3+15 ..[[%" style="fill:#FFFFFF;font-size:5">]]..tostring(H:get(O,N))..[[</text>
                            ]]local Q=H.Range[N][O]if Q[1]=="boolean"then z=z..[[<text x="30%" y="]]..L*3+15 ..[[%" style="fill:#FFFFFF;font-size:5">{]]..tostring(not H:get(O,N))..[[}</text>]]self:addButton(30,L*3+13.2,5,2.5,function()H:set(O,not H:get(O,N),N)end)elseif Q[1]=="string"then local m=0;for p,R in pairs(Q[2])do z=z..[[<text x="]]..30+m..[[%" y="]]..L*3+15 ..[[%" style="fill:#FFFFFF;font-size:5">{]]..R..[[}</text>]]self:addButton(30+m,L*3+13.2,#R*1.5,2.5,function()H:set(O,R,N)end)m=m+#R+2 end else end end end end;return z end)if unitType~="gunner"then self:addMenu("Commander",function(v,w,C,D)if D and(9<=w and w<=98 and 2<=v and v<=68)then if b~=nil then b:setUpdateState(false)end;a=a+system.getMouseWheel()*-1 else if b~=nil then b:setUpdateState(true)end end;return""end)end end;function self:setScreen(v,w,C,S)local T=false;local D=false;v=v*100;w=w*100;if 0<=w and w<=100 and 0<=v and v<=100 then T=true;if 9<=w and w<=98 and 2<=v and v<=98 then D=true end end;if system.isViewLocked()~=1 and unitType~="remote"then return""end;if not d then return end;i={}self:addButton(2,2,17.6,5,function()g="Main"end)self:addButton(21.6,2,17.6,5,function()g="Commander"end)self:addButton(41.2,2,17.6,5,function()g="Ship"end)self:addButton(60.8,2,17.6,5,function()g="Pilot"end)self:addButton(80.4,2,17.6,5,function()g="Settings"a=0 end)self:addButton(92.5,92.5,5,5,function()system.lockView(0)d=false;c:freeMouse(false)if b~=nil then b:setUpdateState(true)end end)local z=""if unitType=="gunner"then z=[[        
                <svg style="width:100%;height:100%" viewBox="0 0 300 300">
                    <rect x="0%" y="0%" rx="2" ry="2" width="100%" height="100%" style="fill:#000000;fill-opacity:0.35" />
        
                    <rect x="2%" y="2%" rx="2" ry="2" width="17.6%" height="5%" style="fill:#4682B4;fill-opacity:0.8" />
                    <rect x="21.6%" y="2%" rx="2" ry="2" width="17.6%" height="5%" style="fill:#4682B4;fill-opacity:0.8" />
                    <rect x="41.2%" y="2%" rx="2" ry="2" width="17.6%" height="5%" style="fill:#4682B4;fill-opacity:0.8" />
                    <rect x="60.8%" y="2%" rx="2" ry="2" width="17.6%" height="5%" style="fill:#4682B4;fill-opacity:0.8" />
                    <rect x="80.4%" y="2%" rx="2" ry="2" width="17.6%" height="5%" style="fill:#4682B4;fill-opacity:0.8" />
        
                    <text x="8%" y="5.5%" style="fill:#FFFFFF;font-size:8">Main</text>
                    <text x="22%" y="5.5%" style="fill:#FFFFFF;font-size:8">Commander</text>
                    <text x="47%" y="5.5%" style="fill:#FFFFFF;font-size:8">Ship</text>
                    <text x="66.5%" y="5.5%" style="fill:#FFFFFF;font-size:8">Pilot</text>
                    <text x="83.8%" y="5.5%" style="fill:#FFFFFF;font-size:8">Settings</text>]]else z=[[        
                    <svg style="width:100%;height:100%" viewBox="0 0 300 300">]]end;local U,V=pcall(h[g],v,w,C,D)if U then z=z..V else if devMode then print(V)end end;return z..[[<text x="94%" y="97%" style="fill:#FFFFFF;font-size:14">X</text></svg>]]end;return self
        
        end
        package.preload[packagePrefix.."screener"] = function()
           local self={}local a=false;local b=false;self.loadPrio=10;local c=getPlugin("config")local d={menuitmwidth=1/8,menuitmheight=1/16,offsetx=0,offsety=0,width=1*1/3,height=1*1/3,tag="screen",totalWidth=system.getScreenHeight(),totalHeight=system.getScreenWidth(),perspective="third",parent="mainScreenThird"}local e={}function self:hotkeyState(f)if self.pressedRegister[f]==1 then return 1 end;return 0 end;function self:startHotkeyPressed(f)self.pressedRegister[f]=1 end;function self:endHotkeyPressed(f)self.pressedRegister[f]=nil end;function self:freeMouse(g)if a and g then print("setupMode off")a=false end;b=g;system.lockView(b)end;function self:addButton(h,i,j,k,l,m,n)end;function self:addScreen(o,p)curr={}for q,r in pairs(d)do if p[q]==nil then curr[q]=r else curr[q]=p[q]end end;curr["name"]=o;e[o]=curr end;function self:getPerspectiveList()return{"first","third"}end;function self:getPerspective()local s=system.getCameraMode()if s==1 then return"first"else return"third"end end;local t={}function self:addView(u,v)assert(type(u)=="string","name isn't a string, type was "..type(u))assert(type(v)=="table",u..": viewObj isn't a table, type was "..type(v))t[u]=v;register:callAction("registerAddView",u)end;function self:removeView(u)if t[u]==nil then return false end;t[u]=nil;register:callAction("registerRemoveView",u)end;function self:getViewList(w)local x={}for y,z in pairs(t)do if z==nil or z.viewTags==nil then system.print("No view tags: '"..y)else for A,B in pairs(z.viewTags)do if w==nil or B==w then table.insert(x,y)end end end end;table.sort(x)return x end;function self:renderView(u,screen,...)if t[u]==nil then system.print("Render of view '"..(u or"???").."' failed, because it there is no such view registered!","")end;local v=t[u]if v.setScreen~=nil then local C,D=pcall(v.setScreen,v,screen,...)if C then return D else system.print(u.." in setScreen:",D)return nil end else system.print(u.." render has no function 'setScreen'")end end;function self:renderViewRequireRerender(u,screen,...)if self.viewRegister[u]==nil then system.print("Rerender request of view '"..(u or"???").."' failed, because it there is no such view registered!","")end;local v=t[u]if v.requireRerender~=nil then local C,D=pcall(v.requireRerender,v,screen,...)if C then return D else system.print(u.." in renderViewRequireRerender:",D)return nil end end;return true end;function self:actionToHtml(E,...)local F,G=register:callAction(E,...),""for A,r in pairs(F)do if r then G=G..r end end;return G end;function screenObj(u)return e[u]end;local H=nil;function self:colors()if H==nil or H.hsl~=modeColors[mode]then if modeColors[mode]==nil then modeColors[mode]=290 end;local I=math.max(0,math.min(modeColors[mode],360))H={hsl=I,sqLeftHsl=I+270.0,sqTwoRight=I+180.0,warn=5}if H.sqLeftHsl>360 then H.sqLeftHsl=H.sqLeftHsl-360 end;if H.sqTwoRight>360 then H.sqTwoRight=H.sqTwoRight-360 end;if H.hsl<45 or H.hsl>315 then H.warn=H.sqTwoRight end end;return H end;function drawAllScreensCss()local J=self:colors()local K=[[
                                    * { font-family:Montserrat }
                                    body { margin: 0}
                                    svg {display:block; position:absolute; top:auto; left:auto}
                                    svg svg { overflow: visible }
                                    .screenSvg { position: relative; margin: auto 0; }
                                    .screen { margin:0; padding:0; position: absolute; left: 0; top: 0; border: 2px solid transparent }
        							.lfill { fill:hsl(]]..J.hsl..[[, 93.6%, 56.9%)}
                                    .sfill { fill:hsl(]]..J.hsl..[[, 100%, 50%) }
        							.lstroke { stroke:hsl(]]..J.hsl..[[, 93.6%, 56.9%)}
                                    .sstroke { stroke:hsl(]]..J.hsl..[[, 100%, 50%) }
        							.bstroke { stroke:black }
                                ]]if a then K=K..[[
        							.screen { border: 2px solid hsl(]]..J.hsl..[[, 93.6%, 56.9%) }
        							.menu { position: absolute; right: 0; top: 0; width: 100%; height: 3.125%; overflow: hidden; z-index: 1000 }
        							.mItm { z-index:inherit; background-color:hsl(]]..J.hsl..[[, 100%, 50%);position: relative; float: right; height: 100%; width: calc(100% / 24); border: 2px solid hsl(]]..J.hsl..[[, 93.6%, 56.9%); overflow: hidden; color: white;display: flex;align-items: center;justify-content: center; }
        						]]end;local s=self:getPerspective()for u,A in pairs(e)do screen=screenObj(u)if s==screen.perspective then K=K..[[
        								#]]..u..[[ { width: ]]..screen.width*100 ..[[%; height: ]]..screen.height*100 ..[[%; top: ]]..screen.offsety*100 ..[[%; left: ]]..screen.offsetx*100 ..[[% }
        			]]if a then K=K..[[
        								#]]..u..[[ > .menu { height: ]]..screen.menuitmheight*100 ..[[% }
        								#]]..u..[[ > .menu .mItm { width: ]]..screen.menuitmwidth*100 ..[[% }
        				]]for L,h in pairs(self:getViewList(screen.tag))do local M="scval_"..u.."_"..h;local curr=c:get(M,0)if curr==1 then K=K..[[
        								#]]..u..[[ > .menu .mItm.n]]..L..[[ { background-color:hsl(]]..J.sqTwoRight..[[, 100%, 50%) }
        						]]end end end end end;return K end;register:addAction("staticCssStyle","drawAllScreensCss",drawAllScreensCss)local N={}function drawAllScreens()local O=0;local P,Q,R=self:actionToHtml("staticCssStyle"),"",""local S,T,U,screens={},{},{},{}local s=self:getPerspective()if a then for L,u in pairs(self:getViewList("screen"))do Q=Q..'<div class="mItm text n'..L..'">'..u.."</div>"end;Q=[[
        			<div class="menu screentag">
        				]]..Q..[[
        			</div>
        		]]end;for u,A in pairs(e)do screen=screenObj(u)if s==screen.perspective then if screen.tag=="screen"then if T[screen.parent]==nil then T[screen.parent]=""end;T[screen.parent]=T[screen.parent]..[[
                                           <div id="]]..u..[[" class="screen">
                                            ]]..Q..[[
                                            ]]..self:actionToHtml(u.."Html")..[[
                                           </div>]]end end end;if a then Q=""for L,u in pairs(self:getViewList("hud"))do Q=Q..'<div class="mItm text n'..L..'">'..u.."</div>"end;Q=[[
        			<div class="menu hudtag">
        				]]..Q..[[
        			</div>
        		]]end;for u,A in pairs(e)do screen=screenObj(u)if s==screen.perspective then if screen.tag=="hud"then if U[screen.parent]==nil then U[screen.parent]=""end;if T[u]==nil then T[u]=""end;U[screen.parent]=U[screen.parent]..[[
        									   <div id="]]..u..[[" class="screen">
        										]]..Q..[[
        										]]..self:actionToHtml(u.."Html")..[[
        										]]..T[u]..[[
        									   </div>]]end end end;local V=""if a or b then local W=system.getMousePosX()/d.totalWidth;local X=system.getMousePosY()/d.totalHeight;V=[[
        			<svg style="z-index: 10000;position: absolute;left:]]..W*100 ..[[%;top:]]..X*100 ..[[%" height="20px" width="20px" viewBox="0 0 512 512">
        				<path class="sfill bstroke" d="M434.214,344.448L92.881,3.115c-3.051-3.051-7.616-3.947-11.627-2.304c-3.989,1.643-6.592,5.547-6.592,9.856v490.667
        					c0,4.459,2.773,8.448,6.976,10.005c1.195,0.448,2.453,0.661,3.691,0.661c3.051,0,6.037-1.323,8.085-3.733l124.821-145.6h208.427
        					c4.309,0,8.213-2.603,9.856-6.592C438.182,352.085,437.265,347.52,434.214,344.448z"/>
        			</svg>
        			]]end;for u,G in pairs(U)do V=V..G end;local Y=[[
                                    <head>
                                        <style>
                                            ]]..P..[[
                                        </style>
                                    </head>
                                    <body>
                                        ]]..V..[[
                                    </body>
                                ]]if debugscreen~=nil then debugscreen.setHTML(Y)end;if#screens>0 then for Z,_ in pairs(screens)do local u,a0="screen"..Z,nil;local screen=screenObj(u)for A,h in pairs(self:getViewList(screen.tag))do local a1=u.."_"..h;local M="scval_"..a1;local curr=c:get(M,0)if curr==1 then if self:renderViewRequireRerender(h,_.getMouseX(),_.getMouseY(),_.getMouseState()==1,"real"..a1)then if a0==nil then a0=""end;a0=a0 ..self:renderView(h,_.getMouseX(),_.getMouseY(),_.getMouseState()==1,"real"..a1)end end end;if a0~=nil then _.setHTML(a0)end end end;system.setScreen(Y)end;function self:triggerViewMouseEvent(a2,u,j,k,a3,...)if t[u]==nil then system.print("Render of view '"..(u or"???").."' failed, because it there is no such view registered!","")end;local v=t[u]local a4=v.onMouseUp;if a2==false then a4=v.onMouseDown end;if a4 then local C,D=pcall(a4,v,j,k,a3,...)if C then return D else system.print(u..": error in triggerViewMouseEvent:",a2,D)return nil end else end end;function self:registerDefaultScreen(o,h)local M="scval_"..o.."_"..h;if devMode then print("registering default view "..M)end;c:set(M,1,0)end;function self:register(a5)_ENV=a5;d.totalWidth=system.getScreenWidth()d.totalHeight=system.getScreenHeight()function setActionHtml(o,h)local screen=screenObj(o)local a1=o.."_"..h;local M="scval_"..a1;local curr=c:get(M,0)if curr==1 then if devMode then print("register setActionHtml for "..M)end;register:addAction(o.."Html",a1 .."Html",function()local W=(system.getMousePosX()/d.totalWidth-screen.offsetx)/screen.width;local X=(system.getMousePosY()/d.totalHeight-screen.offsety)/screen.height;if a==false and b==false then W,X=-1,-1 end;return self:renderView(h,W,X,false,a1)end)else register:removeAction(o.."Html",a1 .."Html")end end;function realMouseEvent(a2,screen,a6,j,k)local o=screen.name;for A,_ in pairs(screens)do if _.getId()==a6.getId()then for A,h in pairs(register:getViewList(screen.tag))do local a1=o.."_"..h;local M="scval_"..a1;local curr=c:get(M,0)if curr==1 then self:triggerViewMouseEvent(a2,h,j,k,"real"..a1)end end;return true end end;return false end;function virtualMouseEvent(a2,screen,a7,a8,a9)local s,o=self:getPerspective(),screen.name;local aa,ab=screen.width,screen.height;local ac=screen.menuitmwidth*screen.width;local ad=screen.menuitmheight*screen.height;local ae=a7-screen.offsetx;local af=a8-screen.offsety;if ae>=0 and ae<aa then if af>=0 and af<ab then if not b and af<ad then if a2 then for ag,h in pairs(self:getViewList(screen.tag))do local ah,ai=ag*ac,(ag-1)*ac;if ae>aa-ah and ae<=aa-ai then local a1=o.."_"..h;local M="scval_"..a1;local curr=c:get(M,0)if curr==1 then c:set(M,0,0)else c:set(M,1,0)end;setActionHtml(o,h)end end end else for A,h in pairs(self:getViewList(screen.tag))do local a1=o.."_"..h;local M="scval_"..a1;local curr=c:get(M,0)if curr==1 then self:triggerViewMouseEvent(a2,h,ae/aa,af/ab,a1)end end end;if devMode then local a4="DOWN"if a2 then a4="UP"end;print("Event "..a4 .."Screen "..o.." Type "..a9 .." Relative x "..ae.." Relative y "..af)end;return true end end;return false end;function tableLength(aj)assert(type(aj)=='table','bad parameter #1: must be table')local ak=0;for A in pairs(aj)do ak=ak+1 end;return ak end;function initAllScreens()screenObjCache={}if devMode then print("reinitialize all "..tableLength(e).." screens")end;for u,A in pairs(e)do local screen=screenObj(u)for A,h in pairs(self:getViewList(screen.tag))do setActionHtml(u,h)end;register:addAction("screenMouseUp","realScreenMouseUp"..u,function(a6,j,k)realMouseEvent(true,screen,a6,j,k)end)register:addAction("screenMouseDown","realScreenMouseUp"..u,function(a6,j,k)realMouseEvent(false,screen,a6,j,k)end)register:addAction("mouseUp","screenMouseUp"..u,function(a7,a8,a9)if self:getPerspective()==screen.perspective then virtualMouseEvent(true,screen,a7,a8,a9)end end)register:addAction("mouseDown","screenMouseDown"..u,function(a7,a8,a9)if self:getPerspective()==screen.perspective then virtualMouseEvent(false,screen,a7,a8,a9)end end)end end;self:addScreen("mainScreenFirst",{menuitmwidth=1/24,menuitmheight=1/32,width=1,height=1,tag="hud",perspective="first"})self:addScreen("mainScreenThird",{menuitmwidth=1/24,menuitmheight=1/32,width=1,height=1,tag="hud"})self:addScreen("screen1first",{offsetx=0,perspective="first",parent="mainScreenFirst"})self:addScreen("screen1third",{offsetx=0})self:addScreen("screen2first",{offsetx=0,offsety=1*1/3,perspective="first",parent="mainScreenFirst"})self:addScreen("screen2third",{offsetx=0,offsety=1*1/3})self:addScreen("screen3first",{offsetx=1*0.63,offsety=1*0.25,width=1*0.23,height=1*0.23,perspective="first",parent="mainScreenFirst"})self:addScreen("screen3third",{offsetx=1*0.63,offsety=1*0.25,width=1*0.23,height=1*0.23})self:addScreen("screen4first",{offsetx=1*0.56,offsety=0,width=1*0.20,height=1*0.25,perspective="first",parent="mainScreenFirst"})self:addScreen("screen4third",{offsetx=1*0.56,offsety=0,width=1*0.20,height=1*0.25})register:addAction("registerAddView","viewRegisterWatcher",initAllScreens)initAllScreens()register:addAction("unitOnStart","Screener",function()register:addAction("systemOnUpdate","drawAllScreens",function()if databaseHasChild~=true and screenToggle and(executeTotal==1 or executeTotal%renderEveryXFrames==0)then drawAllScreens()end end)register:addAction("leftmouseStart","mouseStartTracker",function()if a or b then local W=system.getMousePosX()/d.totalWidth;local X=system.getMousePosY()/d.totalHeight;register:callAction("mouseDown",W,X,"hud")return true else return false end end)register:addAction("leftmouseStop","mouseStopTracker",function()if a or b then local W=system.getMousePosX()/d.totalWidth;local X=system.getMousePosY()/d.totalHeight;register:callAction("mouseUp",W,X,"hud")return true else return false end end)end)local al=getPlugin("CommandHandler")al:AddCommand("setup",function(am)a=not a;if a then system.lockView(true)print("setupMode on")else system.lockView(false)print("setupMode off")end end,"Activate/Deactivate screener setup mode")local an=false;al:AddCommand("mouse",function(am)an=not an;self:freeMouse(an)if an then print("mouse on")else print("mouse off")end end,"Mouse on/off")end;return self
        
        end
        package.preload[packagePrefix.."Pipes"] = function()
           local self={}local c="AQN5B4-@7gSt1W?;"function self:valid(d)if d~=c then return false end;return unitType=="remote"or unitType=="command"end;self.version=0.9;self.loadPrio=1000;self.viewTags={"hud"}local e=unit;local f=system;local g;local h,i;function self:register(j)if not self:valid(c)then return end;g=getPlugin("atlas",false,"",true)listPlanets={}for k,m in pairs(g[0])do if k>=400 then break end;table.insert(listPlanets,{m.name[1],vec3(m.center)})end;i={}for k,m in pairs(g[0])do if k>=400 then break end;table.insert(i,{m.name[1],vec3(m.center),500000})end;table.insert(i,{"Central Zone",vec3(13771471,7435803,-128971),18000000})h=initPipes(listPlanets,false)nearestSafeZone(i)local n=getPlugin("screener",true)if n~=nil then n:registerDefaultScreen("mainScreenThird","Pipe")n:registerDefaultScreen("mainScreenFirst","Pipe")n:addView("Pipe",self)end end;function self:setScreen()local o=[[
        		<style>
        			#pipeMain, #pipeMain svg {display:block; position:absolute; top:0; left:0}
        			#pipeMain .text {fill:aqua;font-family:Montserrat;font-weight:bold}
        		</style>
        
                <svg id="pipeMain" height="94.5%" width="100%" viewBox=\"0 0 1920 1080\">]]o=o.."<g font-family=\"Super Sans\" font-size=\"13px\">".."<rect x=\""..1.65 .."%\" y=\""..65.65 .."%\" rx=\"2\" ry=\"2\" width=\"12%\" height=\"5.2%\" style=\"fill:#4682B4;fill-opacity:0.35\" />"local p,q=nearestPipe(h)local s,t=distanceSafeZone(nearestSafeZone(i))if q<100000 then q=tostring(math.floor(q/10)/100).." km"else q=tostring(math.floor(q/1000/2)/100).." su"end;o=o.."<text x=\""..1.65+0.5 .."%\" y=\""..65.65+2 .."%\" style=\"fill:#FFFFFF\">Pipe "..string.sub(p,0,16).."</text>".."<text x=\""..1.65+8.5 .."%\" y=\""..65.65+2 .."%\" style=\"fill:#FFFFFF\">"..q.."</text>"local u;if t>=0 then u="#00FF00"else u="#FF0000"end;if t<100000 and t>-100000 then t=tostring(math.floor(t/10)/100).." km"else t=tostring(math.floor(t/1000/2)/100).." su"end;o=o.."<text x=\""..1.65+0.5 .."%\" y=\""..65.65+4 .."%\" style=\"fill:#FFFFFF\">Safezone "..string.sub(s,0,16).."</text>".."<text x=\""..1.65+8.5 .."%\" y=\""..65.65+4 .."%\" style=\"fill:"..u.."\">"..t.."</text>"return o.."</svg>"end;function initPipes(v,w)local x={}if w then for y=2,#v,1 do table.insert(x,{v[1][1].." - "..v[y][1],v[1][2],vec3(v[y][2])-vec3(v[1][2])})end else for z=1,#v-1,1 do for y=z+1,#v,1 do table.insert(x,{v[z][1].." - "..v[y][1],v[z][2],vec3(v[y][2])-vec3(v[z][2])})end end end;return x end;function nearestPipe(x)local A=vec3(construct.getWorldPosition())local B=0;local C=0;local D=0;for y=1,#x,1 do a=x[y][2]-A;b=x[y][3]r=(-1*a.x*b.x-a.y*b.y-a.z*b.z)/(b.x*b.x+b.y*b.y+b.z*b.z)l=vec3(x[y][2].x+r*b.x,x[y][2].y+r*b.y,x[y][2].z+r*b.z)B=(l-A):len()if(C==0 or B<C)and r>=0 and r<=1 then C=B;D=y end end;return x[D][1],C end;function nearestSafeZone(E)local A=vec3(construct.getWorldPosition())local F=0;local G=0;local H;for y=1,#E,1 do H=math.abs(vec3(A-E[y][2]):len()-E[y][3])if F==0 or H<F then G=y;F=H end end;return E[G]end;function distanceSafeZone(I)local A=vec3(construct.getWorldPosition())local J=vec3(A-I[2]):len()return I[1],construct.getDistanceToSafeZone()*-1 end;function self:getSafeZone()return contactSafeZone(nearestSafeZone(i))end;function contactSafeZone(I)local A=vec3(construct.getWorldPosition())local l=vec3(A-I[2]):len()local r=I[3]/l;local K=I[2]+r*vec3(A-I[2])self.nearestSafeZone=K;return K end;return self
        
        end
        package.preload[packagePrefix.."FlightHud"] = function()
           local self={}local a="AQN5B4-@7gSt1W?;"function self:valid(b)if b~=a then return false end;return unitType=="remote"or unitType=="command"end;self.version=0.9;self.loadPrio=1000;self.viewTags={"hud"}local c=unit;local d=system;local e=0;local f;function self:register(g)if not self:valid(a)then return end;register:addAction("option7Start","Waypoint",function()system.setWaypoint("::pos{0,0,-91264.7828,408204.8952,40057.4424}")end)f=getPlugin("BaseFlight",true,"AQN5B4-@7gSt1W?;")if f==nil then return end;if core==nil then return end;self.SpaceTanks,self.RocketTanks=getTankId()local h=getPlugin("screener",true)if h~=nil then h:registerDefaultScreen("mainScreenThird","FlightHud")h:registerDefaultScreen("mainScreenFirst","FlightHud")h:addView("FlightHud",self)end end;local i={atmofueltank={{w=10000,mv=51200,me=5480},{w=1300,mv=6400,me=988.67},{w=150,mv=1600,me=182.67},{w=0,mv=400,me=35.03}},spacefueltank={{w=10000,mv=76800,me=5480},{w=1300,mv=9600,me=988.67},{w=150,mv=2400,me=182.67},{w=0,mv=2400,me=182.67}},rocketfueltank={{w=65000,mv=50000*0.8,me=25740},{w=1300,mv=6400*0.8,me=4720},{w=150,mv=800*0.8,me=886.72},{w=0,mv=400*0.8,me=173.42}}}function tankStatsDefault(j,k)for l,m in pairs(i[j])do if k>m.w then return m.mv,m.me end end;return 0,0 end;function tankStats(n,o,p,q)local r=false;for l,s in pairs(_ENV[o])do if s.getLocalId()==n then r=true;p=s.getMaxVolume()*4;q=s.getSelfMass()break end end;return r,p,q end;function CalculateFuelLevel(n)return(core.getElementMassById(n[1])-n["me"])/n["mv"]end;function getTanks()local t,u,v={},{},{}local w=core.getElementIdList()fuelTankHandlingAtmos=fuelTankHandlingAtmos or 0;fuelTankHandlingSpace=fuelTankHandlingSpace or 0;fuelTankHandlingRocket=fuelTankHandlingRocket or 0;ContainerOptimization=ContainerOptimization or 0;FuelTankOptimization=FuelTankOptimization or 0;local function x(y)local z,A=0,0;if ContainerOptimization>0 then z=ContainerOptimization*0.05 end;if FuelTankOptimization>0 then A=FuelTankOptimization*0.05 end;return y*(1-(z+A))end;local B={atmo={},space={},rocket={}}local C=getPlugin("slots")for l,n in pairs(w)do local D=core.getElementClassById(n)local E=C:getClassType(D)if E~=nil then if E=="atmofueltank"or E=="spacefueltank"or E=="rocketfueltank"then local k=core.getElementMaxHitPointsById(n)local F=0;if E=="atmofueltank"then F=fuelTankHandlingAtmos elseif E=="spacefueltank"then F=fuelTankHandlingSpace elseif E=="rocketfueltank"then F=fuelTankHandlingRocket end;local p,q=tankStatsDefault(E,k,F)local r=false;r,p,q=tankStats(n,E,p,q)if not r then p=p+p*F*0.2;p=x(p)end;local G={[1]=n,["mv"]=p,["me"]=q}if E=="atmofueltank"then table.insert(B.atmo,G)elseif E=="spacefueltank"then table.insert(B.space,G)elseif E=="rocketfueltank"then table.insert(B.rocket,G)end end end end;for l,H in pairs(B)do table.sort(H,function(I,J)return I[1]<J[1]end)end;return B.space,B.rocket,B.atmo end;function self:setScreen()if construct.getMaxSpeed()<700000 then maxSpeed=construct.getMaxSpeed()end;local K=math.floor(unit.getAxisCommandValue(axisCommandId.longitudinal)*100)local L=100;for M,N in pairs(self.SpaceTanks)do local O=CalculateFuelLevel(N)*100;if O<L then L=O end end;L=round(L)local P=20;local Q;local R=[[
        			<style>
        				#FlightHudMain, #FlightHudMain svg {display:block; position:absolute; top:0; left:0} 
        				#FlightHudMain .majorLine {stroke:aqua;opacity:0.7;stroke-width:3;fill-opacity:0;}
        				#FlightHudMain .minorLine {stroke:aqua;opacity:0.3;stroke-width:3;fill-opacity:0;}
        				#FlightHudMain .text {fill:aqua;font-family:Montserrat;font-weight:bold}
        			</style>
                    <svg id="FlightHudMain" height="94.5%" width="100%" viewBox="0 0 1920 1080">
        				<rect x="36.525%" y="93.95%" rx="2" ry="2" width="15.40%" height="4.8%" style="fill:#4682B4;fill-opacity:0.35" />
        				<rect x="36.75%" y="96.4%" width="7.25%" height="1.9%" style="fill:none;stroke:#FFFFFF;stroke-width:1px" />
        				<rect x="44.5%" y="96.4%" width="7.25%" height="1.9%" style="fill:none;stroke:#FFFFFF;stroke-width:1px" />
        				<text x="36.75%" y="95.8%" font-family="Super Sans" text-anchor="start" style="fill:#FFFFFF;font-size:15px">Throttle (]]..K..[[%)</text>
                ]]if engine[1]~=nil then if engine[1].getThrust~=nil then K=engine[1].getThrust()/engine[1].getMaxThrust()*100 end end;for S=0,19,1 do if K>0 then R=R.."<rect width=\"0.25%\" height=\"1.225%\" x=\""..36.9+0.35*S.."%\" y=\"96.7%\" style=\"fill:#AFEEEE\" />"end;if K<=0 then R=R.."<rect width=\"0.25%\" height=\"1.225%\" x=\""..36.9+0.35*S.."%\" y=\"96.7%\" style=\"fill:#2C3539\" />"end;K=K-5 end;R=R.."<text x=\"44.5%\" y=\"95.8%\" font-family=\"Super Sans\" text-anchor=\"start\" style=\"fill:#FFFFFF;font-size:15px\">Fuel ("..L.."%)</text>"if L<P and blink then Q="#FF0000"else Q="#FFD801"end;for S=0,19,1 do if L>0 then R=R.."<rect width=\"0.25%\" height=\"1.225%\" x=\""..44.65+0.35*S.."%\" y=\"96.7%\" style=\"fill:"..Q.."\" />"end;if L<=0 then R=R.."<rect width=\"0.25%\" height=\"1.225%\" x=\""..44.65+0.35*S.."%\" y=\"96.7%\" style=\"fill:#2C3539\" />"end;L=L-5 end;local T,U=f:getBrakeTime()R=R.."<rect x=\""..36.525 .."%\" y=\""..91 .."%\" rx=\"2\" ry=\"2\" width=\"15.4%\" height=\"2.8%\" style=\"fill:#4682B4;fill-opacity:0.35\"/>"R=R.."<text x=\""..36.75 .."%\" y=\""..91+2 .."%\" style=\"fill:#FFFFFF;font-size:11px\">".."Break:".."</text>".."<text x=\""..36.525+2.3 .."%\" y=\""..91+2 .."%\" style=\"fill:#FFFFFF;font-size:11px\">"..getDistanceDisplayString(T,2).." ("..FormatTimeString(U)..")".."</text>"R=R.."<text x=\""..44+0.5 .."%\" y=\""..91+2 .."%\" style=\"fill:#FFFFFF;font-size:11px\">".."MaxSpeed:".."</text>".."<text x=\""..44+4 .."%\" y=\""..91+2 .."%\" style=\"fill:#FFFFFF;font-size:11px\">"..round(maxSpeed*3.6).." km/h</text>"R=R.."</g>"R=R.."<rect x=\"28.25%\" y=\"89.2%\" rx=\"2\" ry=\"2\" width=\"8.2%\" height=\"2.6%\" style=\"fill:#4682B4;fill-opacity:0.35\" />"if f.brake==0 then Q="#FFFFFF"else Q="#FF0000"end;R=R.."<text x=\"28.5%\" y=\"91.2%\" font-family=\"Super Sans\" text-anchor=\"start\" style=\"fill:"..Q..";font-size:15px\">".."Handbreak (G) </text>"R=R.."</svg>"e=e+1;if e==15 then if blink then blink=false else blink=true end;e=0 end;return R end;function getDistanceDisplayString(V,W)local X=V>100000;if W==nil then W=1 end;if X then return round(V/1000/200,W).." SU"elseif V<1000 then return round(V,W).." M"else return round(V/1000,W).." KM"end end;function FormatTimeString(Y)local Z=0;local _=0;local a0=0;if Y<60 then Y=math.floor(Y)elseif Y<3600 then Z=math.floor(Y/60)Y=math.floor(Y%60)elseif Y<86400 then _=math.floor(Y/3600)Z=math.floor(Y%3600/60)else a0=math.floor(Y/86400)_=math.floor(Y%86400/3600)end;if a0>0 then return a0 .."d ".._.."h"elseif _>0 then return _.."h "..Z.."m"elseif Z>0 then return Z.."m "..Y.."s"elseif Y>0 then return Y.."s"else return"0s"end end;return self
        
        end
        package.preload[packagePrefix.."BaseFlight"] = function()
           local self={}function self:valid(a)return unitType=="remote"or unitType=="command"end;self.version=0.9;self.loadPrio=1000;local b=unit;local c=system;local d={}local e=""local f=true;function self:register(g)_ENV=g;if not self:valid()then return end;if Nav==nil then Nav=Navigator.new(system,core,unit)end;if Nav.control.isRemoteControlled()==1 then player.freeze(1)end;local h=0;local i=0;local j=0;local k=0;if vec3(construct.getWorldVelocity()):len()<10 then k=1 end;register:addAction("systemOnUpdate","NavUpdate",function()if f then Nav:update()end end)register:addAction("forwardStart","forwardStartFlight",function()h=-1 end)register:addAction("backwardStart","backwardStartFlight",function()h=1 end)register:addAction("yawleftStart","yawleftStartFlight",function()j=1 end)register:addAction("yawrightStart","yawrightStartFlight",function()j=-1 end)register:addAction("strafeleftStart","strafeleftStartFlight",function()Nav.axisCommandManager:updateCommandFromActionStart(axisCommandId.lateral,-1.0)end)register:addAction("straferightStart","straferightStartFlight",function()Nav.axisCommandManager:updateCommandFromActionStart(axisCommandId.lateral,1.0)end)register:addAction("leftStart","leftStartFlight",function()i=-1 end)register:addAction("rightStart","rightStartFlight",function()i=1 end)register:addAction("upStart","upStartFlight",function()Nav.axisCommandManager:updateCommandFromActionStart(axisCommandId.vertical,1.0)end)register:addAction("downStart","downStartFlight",function()Nav.axisCommandManager:updateCommandFromActionStart(axisCommandId.vertical,-1.0)end)register:addAction("gearStart","gearStartFlight",function()if k==1 then k=0 else k=1 end end)register:addAction("brakeStart","brakeStartFlight",function()k=1 end)register:addAction("stopenginesStart","stopenginesStartFlight",function()Nav.axisCommandManager:resetCommand(axisCommandId.longitudinal)end)register:addAction("speedupStart","speedupStartFlight",function()Nav.axisCommandManager:updateCommandFromActionStart(axisCommandId.longitudinal,5.0)end)register:addAction("speeddownStart","speeddownStartFlight",function()Nav.axisCommandManager:updateCommandFromActionStart(axisCommandId.longitudinal,-5.0)end)register:addAction("speedupLoop","speedupLoopFlight",function()Nav.axisCommandManager:updateCommandFromActionLoop(axisCommandId.longitudinal,1.0)end)register:addAction("speeddownLoop","speeddownLoopFlight",function()Nav.axisCommandManager:updateCommandFromActionLoop(axisCommandId.longitudinal,-1.0)end)register:addAction("forwardStop","forwardStopFlight",function()h=0 end)register:addAction("backwardStop","backwardStopFlight",function()h=0 end)register:addAction("yawleftStop","yawleftStopFlight",function()j=0 end)register:addAction("yawrightStop","yawrightStopFlight",function()j=0 end)register:addAction("strafeleftStop","strafeleftStopFlight",function()Nav.axisCommandManager:updateCommandFromActionStop(axisCommandId.lateral,1.0)end)register:addAction("straferightStop","straferightStopFlight",function()Nav.axisCommandManager:updateCommandFromActionStop(axisCommandId.lateral,-1.0)end)register:addAction("leftStop","leftStopFlight",function()i=0 end)register:addAction("rightStop","rightStopFlight",function()i=0 end)register:addAction("upStop","upStopFlight",function()Nav.axisCommandManager:updateCommandFromActionStop(axisCommandId.vertical,-1.0)end)register:addAction("downStop","downStopFlight",function()Nav.axisCommandManager:updateCommandFromActionStop(axisCommandId.vertical,1.0)end)register:addAction("brakeStop","brakeStopFlight",function()k=0 end)local function l()local c=system;local m=construct;local n=0.8;local o=1;local p=1.5;local q=30;local r=5;local s=3;self.brake=k;local t=h+c.getControlDeviceForwardInput()local u=i+c.getControlDeviceYawInput()local v=j-c.getControlDeviceLeftRightInput()local w=k;local x=vec3(core.getWorldVertical())local y=vec3(m.getWorldOrientationUp())local z=vec3(m.getWorldOrientationForward())local A=vec3(m.getWorldOrientationRight())local B=vec3(m.getWorldVelocity())local C=vec3(m.getWorldVelocity()):normalize()local D=getRoll(x,z,A)local E=math.abs(D)local F=utils.sign(D)local G=vec3(m.getWorldAngularVelocity())local H=t*n*A+u*p*z+v*o*y;local I=1;local J=0;local K=1;local L=s*(H-G)local M=vec3(m.getWorldAirFrictionAngularAcceleration())L=L-M;Nav:setEngineTorqueCommand('torque',L,I,'airfoil','','',K)local N=-w*(q*B+r*C)Nav:setEngineForceCommand('brake',N)local O=''local P=vec3()local Q=false;local R='thrust analog longitudinal'local S=Nav.axisCommandManager:getAxisCommandType(axisCommandId.longitudinal)if S==axisCommandType.byThrottle then local T=Nav.axisCommandManager:composeAxisAccelerationFromThrottle(R,axisCommandId.longitudinal)Nav:setEngineForceCommand(R,T,I)elseif S==axisCommandType.byTargetSpeed then local T=Nav.axisCommandManager:composeAxisAccelerationFromTargetSpeed(axisCommandId.longitudinal)O=O..' , '..R;P=P+T;if Nav.axisCommandManager:getTargetSpeed(axisCommandId.longitudinal)==0 or Nav.axisCommandManager:getCurrentToTargetDeltaSpeed(axisCommandId.longitudinal)<-Nav.axisCommandManager:getTargetSpeedCurrentStep(axisCommandId.longitudinal)*0.5 then Q=true end end;local U='thrust analog lateral'local V=Nav.axisCommandManager:getAxisCommandType(axisCommandId.lateral)if V==axisCommandType.byThrottle then local W=Nav.axisCommandManager:composeAxisAccelerationFromThrottle(U,axisCommandId.lateral)Nav:setEngineForceCommand(U,W,I)elseif V==axisCommandType.byTargetSpeed then local X=Nav.axisCommandManager:composeAxisAccelerationFromTargetSpeed(axisCommandId.lateral)O=O..' , '..U;P=P+X end;local Y='thrust analog vertical'local Z=Nav.axisCommandManager:getAxisCommandType(axisCommandId.vertical)if Z==axisCommandType.byThrottle then local _=Nav.axisCommandManager:composeAxisAccelerationFromThrottle(Y,axisCommandId.vertical)Nav:setEngineForceCommand(Y,_,I,'airfoil','ground','',K)elseif Z==axisCommandType.byTargetSpeed then local a0=Nav.axisCommandManager:composeAxisAccelerationFromTargetSpeed(axisCommandId.vertical)O=O..' , '..Y;P=P+a0 end;if P:len()>constants.epsilon then if k~=0 or Q or math.abs(C:dot(z))<0.95 then O=O..', brake'end;Nav:setEngineForceCommand(O,P,J,'','','',K)end end;self:addFlightMode("Base",l)self:setFlightMode("Base")register:addAction("systemOnFlush","FlightScript",function()local a1=self:getCurrentFlightMode()a1()end)end;function self:getMass()local a2=construct;local a3=0;for a4,a5 in pairs(a2.getPlayersOnBoard())do a3=a3+a2.getBoardedPlayerMass(a5)end;if a3>20000 then a3=a3-20000 end;for a4,a5 in pairs(a2.getDockedConstructs())do a3=a3+a2.getDockedConstructMass(a5)end;return a3+a2.getMass()end;function self:getBrakeTime()local a2=60000/3.6;local m=construct;local a6=m.getMaxBrake()if a6==nil then return 0,0 end;local a7=vec3(m.getWorldVelocity()):len()if a7<1 then return 0,0 end;local a5=math.min(a7,m.getMaxSpeed())local a3=self:getMass()local a8=a3*a2/a6*math.asin(a5/a2)local a9=a3*a2^2/a6*(1-math.sqrt(1-a5^2/a2^2))return a9,a8 end;function self:addFlightMode(aa,ab)d[aa]=ab end;function self:setFlightMode(aa)e=aa end;function self:getFlightMode(aa)return d[aa]end;function self:getCurrentFlightMode()return self:getFlightMode(e)end;function self:setUpdateState(c)f=c end;return self
        
        end
        package.preload[packagePrefix.."AR"] = function()
           local self={}local a="AQN5B4-@7gSt1W?;"function self:valid(b)if b~=a then return false end;return unitType=="remote"or unitType=="command"end;self.version=0.9;self.loadPrio=1000;self.viewTags={"hud"}local c=unit;local d=system;local e;local f;local g=true;function self:register(h)if not self:valid(a)then return end;e=getPlugin("Pipes",true,"AQN5B4-@7gSt1W?;")f=getPlugin("BaseFlight",true,"AQN5B4-@7gSt1W?;")local i=getPlugin("screener",true)if i~=nil then i:registerDefaultScreen("mainScreenThird","AR")i:addView("AR",self)end;Atlas=getPlugin("atlas",false,"",true)local j=getPlugin("specialCoords",true,"",true)if j~=nil then for k,l in pairs(j)do table.insert(Atlas[0],l)end end;local m={{name={"Alpha","Alpha","Alpha"},type={"AlienCore","AlienCore","AlienCore"},center={33946000.0000,71381990.0000,28850000.0000}},{name={"Beta","Beta","Beta"},type={"AlienCore","AlienCore","AlienCore"},center={-145634000.0000,-10578000.0000,-739465.0000}},{name={"Delta","Delta","Delta"},type={"AlienCore","AlienCore","AlienCore"},center={13666000.0000,1622000.0000,-46840000.0000}},{name={"Epsilon","Epsilon","Epsilon"},type={"AlienCore","AlienCore","AlienCore"},center={48566000.0000,19622000.0000,101000000.0000}},{name={"Eta","Eta","Eta"},type={"AlienCore","AlienCore","AlienCore"},center={-73134000.0000,18722000.0000,-93700000.0000}},{name={"Gamma","Gamma","Gamma"},type={"AlienCore","AlienCore","AlienCore"},center={-64334000.0000,55522000.0000,-14400000.0000}},{name={"Iota","Iota","Iota"},type={"AlienCore","AlienCore","AlienCore"},center={966000.0000,-149278000.0000,-739465.0000}},{name={"Kappa","Kappa","Kappa"},type={"AlienCore","AlienCore","AlienCore"},center={-45534000.0000,-46878000.0000,-739465.0000}},{name={"Theta","Theta","Theta"},type={"AlienCore","AlienCore","AlienCore"},center={58166000.0000,-52378000.0000,-739465.0000}},{name={"Zeta","Zeta","Zeta"},type={"AlienCore","AlienCore","AlienCore"},center={81766000.0000,16912000.0000,23860000.0000}}}for k,l in pairs(m)do table.insert(Atlas[0],l)end;register:addAction("option5Start","PlanetSwitch",function()g=not g end)end;function self:setScreen()closestDis=1;closestID=-1;List={}local function n(o,p,q)if o==nil then return end;if o.x~=nil then o={o.x,o.y,o.z}end;local l=library.getPointOnScreen(o)if l[1]==0 and l[2]==0 and l[3]==0 then l={-10,-10,-10}end;if p~=nil then local r={l[1]-0.5,l[2]-0.5}local s=math.sqrt(r[1]^2+r[2]^2)if s<closestDis then closestDis=s;closestID=p;List=q end end;return l end;svg=[[
            <style>
                #ArMain .circle-1 {position: absolute; left: 960px; top: 540px;}
                #ArMain .Pointer {stroke:#FFFFFF;stroke-width:2;fill:none}
                #ArMain .Pointer1 {stroke:#00FF00;stroke-width:2;fill:none}
                #ArMain svg {display:block; position:absolute; top:0; left:0}
                #ArMain text {font-family:Montserrat;fill:#FFFFFF;font-size:10px;}
            </style>
        
        
            <svg id="ArMain" height="100%" width="100%" viewBox="0 0 1920 1080">
            ]]local t=construct.getWorldPosition()local u=construct.getWorldAbsoluteVelocity()local v=vec3(t)local w=construct.getWorldForward()local l;dist=200000000;for k,x in pairs(Atlas[0])do if k>400 then break end;if x.type[1]=="Planet"or x.type[1]=="AlienCore"or x.type[1]=="Station"then else goto y end;l=n(x.center,k,Atlas[0])local s=tostring(round((vec3(x.center)-v):len()/200000,2))if x.type[1]=="Planet"then svg=svg..[[<svg width="30" height="30" viewBox="-150 -150 300 300" x="]]..l[1]*1920-15 ..[[" y="]]..l[2]*1080-15 ..[[">
                    <g stroke="#ccc" fill="#999" stroke-width="24" opacity="0.6">
                    <ellipse cx="0" cy="0" rx="110" ry="110"/>
                    <path d="m 59,-90 c245,-10 -264,325 -170,110 c-40,130 310,-100 165,-110" stroke-width="12"/>
                    </g></svg>]]if g then svg=svg.."<text x=\""..l[1]*1920-(#x.name[1]+#s)*3 .."\" y=\""..l[2]*1080-20 .."\">"..x.name[1]..": "..s.."su</text>"end elseif x.type[1]=="AlienCore"then elseif x.type[1]=="Station"then end::y::end;if f.extraCoords~=nil then for k,l in pairs(f.extraCoords)do l=n(l,k,f.extraCoords)svg=svg..[[<svg width="40" height="40" viewBox="-150 -150 300 300" x="]]..l[1]*1920-20 ..[[" y="]]..l[2]*1080-20 ..[[">
                    <g stroke="#0f0" stroke-width="24" fill="#0f0">
                    <path d="m-50,-90 50,-60 50,60"/>
                    <path d="m-50,90 50,60 50,-60"/>
                    <g stroke-width="4">
                    <path d="m0,-150 0,100"/>
                    <path d="m0,50 0,100"/>
                    <path d="m5,0 4,0"/>
                    <path d="m-9,0 4,0"/>
                    </g></g></svg>]]end end;if e.getSafeZone~=nil then l=n(e:getSafeZone())svg=svg.."<circle class=\"Pointer1\" cx=\""..l[1]*1920 .."\" cy=\""..l[2]*1080 .."\" r=\"12\" />"end;if vec3(u):len()>0.5 then l=n({t[1]+u[1]*dist,t[2]+u[2]*dist,t[3]+u[3]*dist})svg=svg..[[<svg width="30" height="30" viewBox="-150 -150 300 300" x="]]..l[1]*1920-15 ..[[" y="]]..l[2]*1080-15 ..[[">
                <g stroke="#ff0" stroke-width="14" fill="none">
                <ellipse cx="0" cy="0" rx="80" ry="80"/>
                <path d="m0,-150 0,70"/>
                <path d="m-150,0 70,0"/>
                <path d="m150,0 -70,0"/>
                </g></svg>]]l=n({t[1]+u[1]*dist*-1,t[2]+u[2]*dist*-1,t[3]+u[3]*dist*-1})svg=svg..[[<svg width="30" height="30" viewBox="-150 -150 300 300" x="]]..l[1]*1920-15 ..[[" y="]]..l[2]*1080-15 ..[[">
                <g stroke="#ff0" stroke-width="14" fill="none">
                <ellipse cx="0" cy="0" rx="80" ry="80"/>
                <path d="m0,-150 0,70"/>
                <path d="m-69,40 -61,35"/>
                <path d="m69,40 61,35"/>
                <g stroke-width="4">
                <path d="M-57,-57 57,57"/>
                <path d="M-57,57 57,-57"/>
                </g></g></svg>]]end;l=n({t[1]+w[1]*dist,t[2]+w[2]*dist,t[3]+w[3]*dist})svg=svg..[[<svg width="30" height="30" viewBox="-150 -150 300 300" x="]]..l[1]*1920-15 ..[[" y="]]..l[2]*1080-15 ..[[">
                <g stroke="#fff" stroke-width="12" fill="none">
                <ellipse cx="0" cy="0" rx="2" ry="2"/>
                <path d="m-150,0 100,0 50,50 50,-50 100,0"/>
                </g></svg>]]l=n({t[1]+w[1]*dist*-1,t[2]+w[2]*dist*-1,t[3]+w[3]*dist*-1})svg=svg.."<circle class=\"Pointer\" cx=\""..l[1]*1920 .."\" cy=\""..l[2]*1080 .."\" r=\"12\" />"svg=svg.."</svg>"self.closest=List[closestID]return svg end;return self
        
        end
        package.preload[packagePrefix.."CommandHandler"] = function()
           local self={}function self:register(a)_ENV=a;local function b(c)text=string.lower(c)local d=string.sub(text,1,1)if d~=self.prefix then return end;local e=mysplit(string.sub(text,2,#text))local f,g=pcall(CommandList[1][d][1][e[1]],e,c)if not f then print(g)end end;register:addAction("systemOnInputText","CommandHandler",b)end;self.version=0.9;self.loadPrio=5;if unitType=="gunner"then self.prefix="/"elseif unitType=="remote"then self.prefix="!"else self.prefix="/"end;CommandList={{[self.prefix]={{["help"]=function(h)local i=h[2]if i==nil then for j,k in pairs(CommandList[1][self.prefix][2])do print(j..":  "..k)end end end},{["help"]="use this to list all commands"}}},{[self.prefix]="basic commands from the"..unitType or""}}function self:AddCommand(l,m,n)CommandList[1][self.prefix][1][l]=m;CommandList[1][self.prefix][2][l]=n or""end;return self
        
        end
        package.preload[packagePrefix.."Settings"] = function()
           self={}local a=getPlugin("config")self.version=0.9;self.loadPrio=5;self.Default={}self.Range={}self.Description={}function self:add(b,c,d,e,f)if b==nil or c==nil then return"missing Infos"end;e=e or""f=f or"Standard"if d==nil or type(d)~="table"then local g=type(c)if g=="boolean"then d={"boolean"}elseif g=="number"then d={"number",1,10,1}else return"missing Range Infos"end end;if self.Default[f]==nil then self.Default[f]={}self.Range[f]={}self.Description[f]={}end;self.Default[f][b]=c;self.Range[f][b]=d;self.Description[f][b]=e end;function self:rem(b,f)f=f or"Standard"self.Default[f][b]=nil;self.Range[f][b]=nil;self.Description[f][b]=nil end;function self:set(b,h,f)f=f or"Standard"local i=self.Range[f][b]local g=type(h)if i[1]~=g then return end;if g=="number"then h=utils.clamp(h,i[2],i[3])h=(h-i[2])/i[4]h=round(h)h=h*i[4]+i[2]elseif g=="string"then if not inTable(i[2],h)then return end end;a:set(f..b,h,self.Default[f][b])end;function self:get(b,f)f=f or"Standard"return a:get(f..b,self.Default[f][b])end;function self:register(j)_ENV=j end;return self
        
        end
        package.preload[packagePrefix.."config"] = function()
           local self={}local a=nil;local b={}function self:get(c,d)if a==nil then self:load()end;b[c]=true;if a[c]==nil then return d end;if d~=nil and a[c]==d then a[c]=nil;return d end;return a[c]end;function self:set(c,e,d)if a==nil then self:load()end;b[c]=true;if a[c]~=e then if e==d then a[c]=nil else a[c]=e end;self:save()end end;function self:load()if a==nil then if database~=nil and database.hasKey~=nil and database.hasKey("config"..unitType..unit.getLocalId())==1 then local f=database.getStringValue("config"..unitType..unit.getLocalId())a=json.decode(f)end;if a==nil then a={}end end end;function self:save()if a~=nil then if database~=nil and database.hasKey~=nil then database.setStringValue("config"..unitType..unit.getLocalId(),json.encode(a))end end end;function self:cleanup()if a==nil then return end;local g=false;for h,i in pairs(a)do if b[h]==nil then g=true;a[h]=nil end end;if g then self:save()end end;function self:register(j)_ENV=j;register:addAction("systemStop","configCleanup",function()self:cleanup()end)end;return self
        
        end
        package.preload[packagePrefix.."slots"] = function()
           local self={}self.slots=nil;local a={control=true,library=true,system=true,unit=true,player=true,construct=true}function self:calcSlots()self.slots={}local b=unit or{}for c,d in pairs(b)do if a[c]==nil then if type(c)=="string"and type(d)=="table"and type(d.export)=="table"then self.slots[c]=d end end end;return self.slots end;function self:getSlots()if self.slots==nil then self:calcSlots()end;return self.slots end;self.elementsIdList=nil;function self:calcElementList()if core==nil then return end;self.elementsIdList=core.getElementIdList()end;function self:getElementList()if self.elementsIdList==nil then self:calcElementList()end;return self.elementsIdList end;local e={RemoteControlUnit="remote",CockpitHovercraftUnit="command",PVPSeatUnit="gunner",CockpitCommandmentUnit="command",CockpitFighterUnit="command"}local f={Weapo="weapon",Shiel="shield",Radar="radar",CoreU="core"}local g={AntiGravityGeneratorUnit="antigrav",WarpDriveUnit="warpdrive",DataBankUnit="databases",ReceiverUnit="receiver",EmitterUnit="emitter",ScreenUnit="screens",CombatDefense="transponder",AtmoFuelContainer="atmofueltank",SpaceFuelContainer="spacefueltank",RocketFuelContainer="rocketfueltank",CounterUnit="counter",laserDetector="laser",SpaceEngine="engine"}local h={weapon=true,databases=true,screens=true,atmofueltank=true,spacefueltank=true,rocketfueltank=true,radar=true,engine=true}local i={core={"onStressChanged(stress)"},container={"onContentUpdate()"},industry={"onStarted(id,quantity)","onCompleted(id,quantity)","onStatusChanged(status)","onBankUpdate()"},radar={"onEnter(id)","onLeave(id)","onIdentified(id)"},screens={"mouseDown(x,y)","mouseUp(x,y)","onOutputChanged(output)"},laser={"onHit()","onLoss()"},receiver={"onReceived(channel,message)"},shield={"onToggled(active)","onAbsorbed(hitpoints,rawHitpoints)","onVentin(active,restoredHitpoints)","onDown()","onRestored()"},weapon={"onReload(ammoId)","onReloaded(ammoId)","onMissed(targetId)","onDestroyed(targetId)","onElementDestroyed(targetId,itemId)","onHit(targetId,damage)"}}local function j(k)for l,m in ipairs(k)do local n,o=m:match("^([^(]+)%((.*)%)")local p={}for q in o:gmatch("[^%s,]+")do table.insert(p,q)end;for r,s in ipairs(p)do print(string.format("* Slot name %q has options %q.",n,s))end;local t=map(p,function()return"*"end)for r,s in ipairs(t)do print(string.format("* Slot name %q has options %q.",n,s))end end end;function self:getClassType(u)local type;if g[u]~=nil then type=g[u]else local v=string.sub(u,0,5)if f[v]~=nil then type=f[v]end end;return type end;function self:register(w)_ENV=w;for type,r in pairs(h)do _ENV[type]={}end;for r,x in pairs(self:getSlots())do local u=x.getClass()local type=self:getClassType(u)if type==nil then system.print("Unrecognized Type: "..u)else if h[type]==nil then _ENV[type]=x else table.insert(_ENV[type],x)end end end;function compare(y,z)if y~=nil and y.getLocalId and z~=nil and z.getLocalId then return y.getLocalId()<z.getLocalId()end;return nil end;for type,r in pairs(h)do if#_ENV[type]>1 then table.sort(_ENV[type],compare)end end;if#_ENV["databases"]>0 then local A=getPlugin("bankraid",true)if A~=nil then _ENV["database"]=A:new(_ENV["databases"])else _ENV["database"]=_ENV["databases"][1]end end;if _ENV["unitType"]==nil or _ENV["unitType"]==""then if e[unit.getClass()]~=nil then _ENV["unitType"]=e[unit.getClass()]else system.print("Unrecognized unitTypeClass: "..unit.getClass())end end;register:addAction("antigravityStart","antigravityStart",function()if antigrav~=nil then antigrav.toggle()end end)register:addAction("systemOnUpdate","frameCounter",function()if executeTotal==nil then executeTotal=0 end;if executeSet==nil then executeSet=0 end;executeTotal=executeTotal+1;executeSet=executeSet+1;local B=system.getArkTime()if B-executeTime>1 then executeLastFrames=executeSet;executeSet=1;executeTime=B;local C=false;if C then system.print("Frames: "..executeLastFrames)end end end)register:addAction("systemOnActionStart","systemActionStartAlias",function(D,system)register:callAction(D.."Start",system)register:startHotkeyPressed(D)end)register:addAction("systemOnActionStop","systemActionStopAlias",function(D,system)register:callAction(D.."Stop",system)register:endHotkeyPressed(D)end)register:addAction("systemOnActionLoop","systemActionLoopAlias",function(D,system)register:callAction(D.."Loop",system)end)end;return self
        
        end
        package.preload[packagePrefix.."register"] = function()
           local self={}self.functionRegister={}self.overwriteRegister={}self.overwriteOrder={}self.viewRegister={}self.pressedRegister={}function self:hotkeyState(a)if self.pressedRegister[a]==1 then return 1 end;return 0 end;function self:startHotkeyPressed(a)self.pressedRegister[a]=1 end;function self:endHotkeyPressed(a)self.pressedRegister[a]=nil end;self.switches={}function self:addSwitch(b,c)assert(type(b)=="string","name isn't a string, type was "..type(b))assert(type(c)=="table",b..": entity isn't a table, type was "..type(c))self.switches[b]=c;self:callAction("registerAddSwitch",b)end;function self:getSwitch(b)assert(type(b)=="string","name isn't a string, type was "..type(b))return self.switches[b]end;function self:getSwitches()return self.switches end;self.taskRegister={}self.taskOrder={}local function d(e,f)if e~=nil and f~=nil then return self.taskRegister[e].order<self.taskRegister[f].order end;return nil end;local g=2500;function self:addTask(b,h,i,j)assert(type(b)=="string","addTask: name isn't a string, type was "..type(b))assert(type(h)=="function",b..": func isn't a function, type was "..type(h))if i==nil then i=10 else assert(type(i)=="number",b..": priority has to be number, type was "..type(i))end;if j==nil then j=g else assert(type(j)=="number",b..": rating has to be number, type was "..type(j))assert(j<=g,b..": rating has to be smaller then the allowed max rating of "..g)end;if not self:hasAction("systemUpdate","registerTasker")then self:addAction("systemUpdate","registerTasker",function()self:runTasks()end)end;if self.taskRegister[b]~=nil then self:removeTask(b)end;table.insert(self.taskOrder,b)self.taskRegister[b]={order=i,task=coroutine.create(h),rating=j}if#self.taskOrder>1 then table.sort(self.taskOrder,d)end end;function self:hasTask(b)return self.taskRegister[b]~=nil end;function self:removeTask(b)assert(type(b)=="string","removeTask: Name isn't a string, type was "..type(b))self.taskRegister[b]=nil;for k,l in pairs(self.taskOrder)do if l==b then table.remove(self.taskOrder,k)return end end end;function self:runTasks()local m=0;for n,b in ipairs(self.taskOrder)do local o=self.taskRegister[b]if m+o.rating<=g then if o.task==nil or coroutine.status(o.task)=="dead"then self:removeTask(b)else m=m+o.rating;local p,q=coroutine.resume(o.task)if not p then system.print(b.." in runTasks:",q)self:removeTask(b)end end end end end;function self:hasAction(r,b)return self.functionRegister[r]~=nil and self.functionRegister[r][b]~=nil end;function self:addAction(r,b,h)assert(type(r)=="string","action isn't a string, type was "..type(r))assert(type(b)=="string",r..": name isn't a string, type was "..type(b))assert(type(h)=="function",r..":"..b..": func isn't a function, type was "..type(h))if self.functionRegister[r]==nil then self.functionRegister[r]={}end;self.functionRegister[r][b]=h end;function self:removeAction(r,b)if self.functionRegister[r]==nil or self.functionRegister[r][b]==nil then return false end;self.functionRegister[r][b]=nil;return true end;function self:callAction(r,...)local s={}if self.functionRegister[r]~=nil then for b,h in pairs(self.functionRegister[r])do if h~=nil then local t,u=pcall(h,...)if t then s[b]=u else system.print(b.." in callAction:",u)end end end end;return s end;function self:callActionSpecific(r,b,...)assert(self.functionRegister[r]=="table",r..":".." not registered")assert(self.functionRegister[r][b]=="function",r..":"..b..": called specified function isn't a function, type was "..type(self.functionRegister[r][b]))local t,u=pcall(self.functionRegister[r][b],...)if t then return u else system.print(b.." in callActionSpecific:",u)end end;return self
        
        end
        system.rawPrint=system.print;function system.print(a,b)if b then b=tostring(b):gsub('"%-%- |STDERROR%-EVENTHANDLER[^"]*"','chunk'):gsub("&","&amp;"):gsub("<","&lt;"):gsub(">","&gt;")else b="???"end;system.rawPrint(a.." "..b)end;function print(c)system.rawPrint(tostring(c))end;local d=unit;if devMode==true and player.hasDRMAutorization()~=1 then print("devMode set but no DRM auth")error("devMode set but no DRM auth")d.exit()end;if d.hasDRM()==0 then if devMode~=true then print("DRM Required")error("DRM Required")d.exit()else print("DRM requirement skipped by devMode")end end;d.hideWidget()print("Hyperion Gunner Script V0.95")print("by Hyperion Scripting")system.showScreen(1)system.setScreen([[<svg xmlns="http://www.w3.org/2000/svg" width="40%" style="left:30%;top:10%;display:block; position:absolute;" viewBox="0 0 973.35 837.57">
            <defs>
            <style>
            .cls-1 { fill: #798a99; }
            .cls-2 { fill: #bd1730; }
            </style>
            </defs>
            <path class="cls-1" d="M583,93.5H437.52C353.65,361.21,211.41,603.08,25.7,804.26L98.3,930a1892.42,1892.42,0,0,1,828.89-.22l70.63-122.29C810.63,605.68,667.33,362.63,583,93.5ZM508.29,740.05A945,945,0,0,0,206.5,789.18C357.22,655.35,464.94,474.16,506.32,269c41.16,204.15,148,384.54,297.51,518.13A945.66,945.66,0,0,0,508.29,740.05Z" transform="translate(-25.08 -93)"/>
            <circle class="cls-2" cx="481.42" cy="523.5" r="118"/>
            </svg>
            <svg height="100%" width="100%" viewBox="0 0 1920 1080" style="left:0;top:0;display:block; position:absolute;">
            <text x="40%" y="88%" style="fill:#FFFFFF;font-size:50px">Hyperion Scripting</text>
            </svg>]])local e=require;require=function(f)return print("require '"..f.."': deprecated, use getPlugin()")end;local g={}local h={}function g:fixName(f)local i=packagePrefix;if string.find(f,i)then f=string.gsub(f,i,"")end;return f end;function g:unloadPlugin(f,j)assert(type(f)=="string","getPlugin: parameter name has to be string, was "..type(f))f=g:fixName(f)local i=packagePrefix;if j then i=""end;if package.loaded~=nil and package.loaded[i..f]~=nil then package.loaded[i..f]=nil end;if h[f]~=nil then if type(h[f])=="table"and type(h[f].unregister)=="function"then h[f].unregister()end;h[f]=nil end end;function g:getPlugin(f,k,l,j)assert(type(f)=="string","getPlugin: parameter name has to be string, was "..type(f))if k==nil then k=false end;f=g:fixName(f)if not g:hasPlugin(f,k,j)then return nil end;if type(h[f])=="table"and h[f].valid~=nil then if h[f]:valid(l)~=true then if not k then print("getPlugin '"..f.."':".." Not valid or compatible")end;return nil end end;return h[f]end;function g:hasPlugin(f,k,j)assert(type(f)=="string","hasPlugin: parameter name has to be string, was "..type(f))if k==nil then k=false end;f=g:fixName(f)local i=packagePrefix;if j then i=""end;if h[f]==nil then h[f]=false;if player.hasDRMAutorization()==1 or package.preload[i..f]~=nil or j then local m,n=pcall(e,i..f)if not m then if k==nil or not k then system.print("hasPlugin '"..f.."': require failed",n)end else h[f]=n end else print("hasPlugin '"..f.."': DRM auth required to load external files")end;if type(h[f])=="table"then if h[f].register~=nil then if _ENV["debugscreen"]==nil then _ENV["debugscreen"]=debugscreen end;if _ENV["register"]==nil then _ENV["register"]=register end;if _ENV["system"]==nil then _ENV["system"]=system end;if _ENV["unit"]==nil then _ENV["unit"]=unit end;if _ENV["player"]==nil then _ENV["player"]=player end;if _ENV["construct"]==nil then _ENV["construct"]=construct end;if _ENV["library"]==nil then _ENV["library"]=library end;local o,p=pcall(h[f].register,h[f],_ENV)if not o and not k then system.print("hasPlugin '"..f.."': register failed",p)end end else if h[f]~=nil and h[f]~=false then if type(h[f])=="string"then print("hasPlugin '"..f.."':"..h[f])else print("hasPlugin '"..f.."': not table value")end end end end;return type(h[f])=="table"end;function unloadPlugin(f,j)return g:unloadPlugin(f,j)end;function hasPlugin(f,k,j)return g:hasPlugin(f,k,j)end;function getPlugin(f,k,l,j)return g:getPlugin(f,k,l,j)end;local q={}unitType=""renderEveryXFrames=1;executeTotal=0;executeSet=0;executeTime=0;executeLastFrames=0;screenToggle=true;mode=-1;forceMode=-1;bootTime=system.getArkTime()useLightStyle=false;local r=120;local s=184;modeColors={}modeColors[0]=r;modeColors[1]=s;fuelTankHandlingSpace=4;fuelTankHandlingRocket=0;fuelTankHandlingAtmos=0;ContainerOptimization=4;FuelTankOptimization=5;function collect_keys(t,u)local v={}for w in pairs(t)do v[#v+1]=w end;table.sort(v,u)return v end;function sortedPairs(t,u)local x=collect_keys(t,u)local y=0;return function()y=y+1;if x[y]then return x[y],t[x[y]]end end end;function tableLength(z)local A=0;for B in pairs(z)do A=A+1 end;return A end;function timeit(C,D)collectgarbage()local E=system.getTime()local F=D()local G=system.getTime()print(C..": "..G-E)return F end;function getRelativePitch(H)return math.deg(math.atan(H[2],H[3]))-90 end;function getRelativeYaw(H)return math.deg(math.atan(H[2],H[1]))-90 end;function mysplit(I,J)if J==nil then J="%s"end;local t={}for c in string.gmatch(I,"([^"..J.."]+)")do table.insert(t,c)end;return t end;function inTable(K,L)if type(K)~="table"then return false end;for w,M in pairs(K)do if M==L then return true,w end end;return false end;function round(N,O)local P=10^(O or 0)if O~=nil then return math.floor(N*P+0.5)/P else return math.floor((N*P+0.5)/P)end end;if not inTable(player.getOrgIds(),2041)then system.print("Corp signatur required")error("Corp signatur required")d.exit()end;register=getPlugin("register")slots=getPlugin("slots")register:callAction("systemStart")local Q={}function addTimer(R,S,T)d.setTimer(R,S)Q[R]=T end;function onTimer(U)if Q[U]~=nil then local V,W=pcall(Q[U])if not V then print("Timer:"..W.."  "..U)end end end;function stopTimer()for w,B in pairs(Q)do d.setTimer(w,0)end end;local X=0;function delay(Y,S)local R="DelayCounter"..X;addTimer(R,S,function()pcall(Y)d.stopTimer(R)end)X=X+1 end;register:addAction("unitOnTimer","Timer",onTimer)if devMode==true then getPlugin("dev",true)getPlugin("devTools",true)end;getPlugin("optionals",true)for f,B in sortedPairs(package.preload)do getPlugin(f,true)end;delay(function()register:callAction("unitOnStart")end,0.5)
        
    onStop:
      lua: if register ~= nil then register:callAction("unitOnStop",unit) end
    onTimer(tag):
      lua: if register ~= nil then register:callAction("unitOnTimer",tag,unit) end
  system:
    onActionStart(action):
      lua: if register ~= nil then register:callAction("systemOnActionStart",action,system) end
    onActionStop(action):
      lua: if register ~= nil then register:callAction("systemOnActionStop",action,system) end
    onActionLoop(action):
      lua: if register ~= nil then register:callAction("systemOnActionLoop",action,system) end
    onUpdate:
      lua: if register ~= nil then register:callAction("systemOnUpdate",system) end
    onFlush:
      lua: if register ~= nil then register:callAction("systemOnFlush",system) end
    onInputText(text):
      lua: if register ~= nil then register:callAction("systemOnInputText",text,system) end
    onCameraChanged(mode):
      lua: if register ~= nil then register:callAction("systemOnCameraChanged",mode,system) end
  core:
    onStressChanged(stress):
      lua: if register ~= nil then register:callAction("coreOnStressChanged",stress,core) end
